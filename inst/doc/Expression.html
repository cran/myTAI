<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="date" content="2015-07-09" />

<title>Gene Expression Analysis with myTAI</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Gene Expression Analysis with <code>myTAI</code></h1>
<h4 class="date"><em>2015-07-09</em></h4>
</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In the <a href="Introduction.html">Introduction</a> vignette we introduced and discussed how phylotranscriptomics can be applied to capture evolutionary signals in (developmental) transcriptomes. Furthermore, in the <a href="Enrichment.html">Enrichment Analyses</a> vignette we provide a use case to correlate specific groups or sets of genes with their predicted evolutionary origin. Here, we aim to combine previously introduced techniques with <em>classic</em> gene expression analyses to detect possible functional causes for the observed transcriptome conservation.</p>
<p>In other words, phylotranscriptomics allows us to detect stages or periods of evolutionary conservation and is able to predict the evolutionary origin of process or trait specific genes based on enrichment analyses. By combining evolutionary enrichment analyses with the functional annotation of process or trait specific genes (see <a href="https://github.com/HajkD/biomartr/blob/master/vignettes/Functional_Annotation.Rmd">Functional Annotation</a> and <a href="https://github.com/HajkD/biomartr/blob/master/vignettes/Phylotranscriptomics.Rmd">Phylotranscriptomics</a> for details) the detection of evolutionary signals can be correlated with functional processes. Then, performing gene expression analyses on corresponding process or trait specific genes allows users to detect potential causes of stage/period specific evolutionary transcriptome conservation.</p>
<p>The following sections introduce main gene expression data analysis techniques implemented in <code>myTAI</code>:</p>
<ul>
<li>Detection of Differentially Expressed Genes (DEGs)</li>
<li>Fold-Change</li>
<li>Welch t-test</li>
<li>Wilcoxon Rank Sum Test (Mann-Whitney U test)</li>
<li><p>Negative Binomial (Exact Tests)</p></li>
<li><p>Collapsing Replicate Samples</p></li>
<li><p>Filter for Expressed Genes</p></li>
<li><p>Compute the Statistical Significance of Each Replicate Combination</p></li>
</ul>
</div>
<div id="detection-of-differenentially-expressed-genes-degs" class="section level2">
<h2>Detection of Differenentially Expressed Genes (DEGs)</h2>
<p>A variety of methods have been published to detect differentially expressed genes. Some methods are based on non-statistical quantification of expression differences (e.g. fold-change and log-fold-change), but most methods are based on statistical tests to quantify the significance of differences in gene expression between samples. These statistical methods can furthermore be divided into two methodological categories: parametric tests and non-parametric tests. The <code>DiffGenes()</code> function available in <code>myTAI</code> implements the most popular and useful methods to detect differentially expressed genes. In the literature, different methods have been introduced and discussed for microarray technologies versus RNA-Seq technologies.</p>
<p>In this section we will introduce all methods implemented in <code>DiffGenes()</code> using small examples and will furthermore, discuss published advantages and disadvantages of each method and each mRNA quantification technology.</p>
<p><strong>Note that when using <code>DiffGenes()</code> it is assumed that your input dataset has been normalized before passing it to <code>DiffGenes()</code>. For RNA-Seq data <code>DiffGenes()</code> assumes that the libraries have been normalized to have the same size, i.e., to have the same expected column sum under the null hypothesis (or the lib.size argument in <code>DiffGenes()</code> is specified accordingly).</strong></p>
</div>
<div id="fold-changes" class="section level2">
<h2>Fold-Changes</h2>
<p>A fold change in gene expression is simply the ratio of the gene expression level of one sample against a second sample: <span class="math">\(\frac{e_{i1}}{e_{i2}}\)</span>, where <span class="math">\(e_{i1}\)</span> is the expression level of gene <span class="math">\(i\)</span> in sample one and <span class="math">\(e_{i2}\)</span> is the expression level of gene <span class="math">\(i\)</span> in sample two. In case replicate expression levels are present for each sample the ratio of means of the corresponding replicates is computed: <span class="math">\(\frac{\bar{e}_{i1}}{\bar{e}_{i2}}\)</span>, where <span class="math">\(\bar{e}_{i1}\)</span> is the mean of replicate expression levels of gene <span class="math">\(i\)</span> in sample one and <span class="math">\(\bar{e}_{i2}\)</span> is the mean of replicate expression levels of gene <span class="math">\(i\)</span> in sample two.</p>
<ul>
<li><p><strong>Advantages:</strong> Given a small number of replicate values the statistical evaluation of differentially expressed genes might be biased (depending on the statistical test chosen) by underlying sample distributions which are not fulfilled or because a small number of replicate values is not sufficient enough to perform non-parametric tests. Here, fold-changes provide a simple way to quantify gene expression differences between samples by <span class="math">\(n\)</span>-fold enrichment. In our opinion, although the process of choosing a threshold for defining genes as being differentially expressed or not based on fold-change values is purely subjective and relies on common sense, in some cases this procedure will be more suitable than defining differentially expressed genes based on p-values obtained from a test statistic with violated test assumptions.</p></li>
<li><p><strong>Disadvantages:</strong> If used appropriately, statistical tests not only systematically quantify the significance of the observed gene-by-gene differences of expression, but furthermore, accounts the variance of replicate expression levels when comparing the mean difference of replicate expression levels between samples. Hence, the gene specific variance between replicates is also quantified by the p-value returned by the sufficient test statistic which is not quantified by a simple fold-change measure.</p></li>
</ul>
<div id="example-fold-change" class="section level3">
<h3>Example: Fold-Change</h3>
<p>For the following example we assume that <code>PhyloExpressionSetExample[1:5,1:8]</code> stores 5 genes and 3 developmental stages with 2 replicate expression levels per stage.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the fold-change measure</span>
DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                  <span class="dt">nrep          =</span> <span class="dv">2</span>,
                  <span class="dt">method        =</span> <span class="st">&quot;foldchange&quot;</span>,
                  <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))


<span class="kw">head</span>(DEGs)</code></pre>
<pre><code>   Phylostratum      GeneID    S1-&gt;S2    S1-&gt;S3    S2-&gt;S1    S2-&gt;S3    S3-&gt;S1    S3-&gt;S2
1            1 at1g01040.2 1.6713881 2.0806706 0.5983051 1.2448758 0.4806143 0.8032930
2            1 at1g01050.1 1.0273222 1.2709185 0.9734045 1.2371177 0.7868325 0.8083305
3            1 at1g01070.1 1.3087379 1.4044799 0.7640949 1.0731560 0.7120073 0.9318310
4            1 at1g01080.2 0.7779572 0.7286769 1.2854177 0.9366542 1.3723503 1.0676299
5            1 at1g01090.1 0.3803866 0.2288961 2.6289042 0.6017460 4.3687939 1.6618307</code></pre>
<p>The resulting output shows all combinations of fold-changes between samples (developmental stages). Here, <code>S1-&gt;S2</code> denotes that the fold-change was computed for expression levels of stage <code>S1</code> against stage <code>S2</code>.</p>
</div>
<div id="example-log-fold-change" class="section level3">
<h3>Example: Log-Fold-Change</h3>
<p><strong>When selecting <code>method = &quot;log-foldchange&quot;</code> it is assumed that the input <code>ExpressionSet</code> stores <code>log2</code> expression levels. Here, we transform absolute expression levels stored in <code>PhyloExpressionSetExample</code> to <code>log2</code> expression levels using the <code>tf()</code> function before log-fold-changes are computed.</strong></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the logfold-change measure</span>
log.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> <span class="kw">tf</span>(PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],log2),
                      <span class="dt">nrep          =</span> <span class="dv">2</span>,
                      <span class="dt">method        =</span> <span class="st">&quot;log-foldchange&quot;</span>,
                      <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))


<span class="kw">head</span>(log.DEGs)</code></pre>
<pre><code>  Phylostratum      GeneID      S1-&gt;S2     S1-&gt;S3      S2-&gt;S1      S2-&gt;S3     S3-&gt;S1      S3-&gt;S2
1            1 at1g01040.2  0.74104679  1.0570486 -0.74104679  0.31600182 -1.0570486 -0.31600182
2            1 at1g01050.1  0.03888868  0.3458715 -0.03888868  0.30698280 -0.3458715 -0.30698280
3            1 at1g01070.1  0.38817621  0.4900360 -0.38817621  0.10185975 -0.4900360 -0.10185975
4            1 at1g01080.2 -0.36223724 -0.4566488  0.36223724 -0.09441158  0.4566488  0.09441158
5            1 at1g01090.1 -1.39446159 -2.1272350  1.39446159 -0.73277345  2.1272350  0.73277345</code></pre>
<p>The resulting output stores all combinations of log fold-changes between samples (developmental stages).</p>
</div>
</div>
<div id="welch-t-test" class="section level2">
<h2>Welch t-test</h2>
<p>The <code>Welch t-test</code> is a parametric test to statistically quantify the difference of sample means in cases where the assumption of homogeneity of variance (equal variances in the two populations) is violated (Boslaugh, 2013). The <code>Welch t-test</code> is a sufficient parameter test for small sample sizes and thus, has been used to detect differentially expressed genes based on p-values returned by the test statistic (Hahne et al., 2008).</p>
<p>In detail, the test statistic is computed as follows:</p>
<p><span class="math">\(t = \frac{\bar{x}_1 - \bar{x}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}\)</span></p>
<p>where <span class="math">\(\bar{x}_1\)</span> and <span class="math">\(\bar{x}_2\)</span> are sample means, <span class="math">\(s_1^2\)</span> and <span class="math">\(s_2^2\)</span> are the sample variances, and <span class="math">\(n_1\)</span> and <span class="math">\(n_2\)</span> are the sample sizes.</p>
<p>The degrees of freedom for Welch’s t-test are then computed as follows:</p>
<p><span class="math">\(df = \frac{\big(\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}\big)^2}{\frac{s_1^4}{n_1^2 (n_1 - 1)} + \frac{s_2^4}{n_2^2 (n_2 - 1)}}\)</span></p>
<p>To perform a sufficient <code>Welch t-test</code> the following assumptions about the input data need to be fulfilled to test whether two samples come from populations with equal means:</p>
<p><strong>Assumptions about input data</strong></p>
<ul>
<li>independent samples</li>
<li>continuous data</li>
<li>(approximate) normality</li>
</ul>
<p>Nevertheless, although in most cases <code>log2</code> expression levels are used to perform the <code>Welch t-test</code> assuming that expression levels are log-normal distributed which approximates a normal distribution in infinity, in most cases the small number of replicates is not sufficient enough to fulfill the (approximate) normality assumption of the <code>Welch t-test</code>.</p>
<p>Due to this fact, non-parametric, sampling based, or generalized linear model based methods have been proposed to quantify p-values of differential expression. Nevertheless, the <code>DiffGenes()</code> function implements the <code>Welch t-test</code> for the detection of differentially expressed genes, allowing users to compare the results with more recent DEG detection methods/methodologies also implemented in <code>DiffGenes()</code>.</p>
<ul>
<li><strong>Advantages:</strong></li>
<li>DEG detection based on statistical quantification</li>
<li>Parametric test resulting in a strong test statistic</li>
<li><p>Can handle small sample sizes</p></li>
<li><strong>Disadvantages:</strong></li>
<li>Test assumptions must be fulfilled to return sufficient p-values<br /></li>
<li>Can hardly assure normality with very sample sizes of <span class="math">\(n = 3,4,5,..\)</span> (replicates)</li>
<li><p>Pairwise comparisons between different stages or experiments</p></li>
</ul>
<div id="example-welch-t-test" class="section level3">
<h3>Example: Welch t-test</h3>
<p>Performing <code>Welch t-test</code> with <code>DiffGenes()</code> can be done by specifying <code>method = &quot;t.test&quot;</code>. Internally <code>DiffGenes()</code> performs a two sided <code>Welch t-test</code>. This means that the <code>Welch t-test</code> quantifies only whether or not a gene is significantly differentially expressed, but not the direction of enrichment (over-expressed or under-expressed).</p>
<p>The <code>PhyloExpressionSetExample</code> we use in the following example stores absolute expression levels. In case your <code>ExpressionSet</code> also stores absolute expression levels (which is likely due to the <code>ExpressionSet</code> standard for Phylotranscriptomics analyses), you can use the <code>tf()</code> function implemented in <code>myTAI</code> to transform absolute expression levels to <code>log2</code> expression levels before performing <code>DiffGenes()</code> with a <code>Welch t-test</code>, e.g. <code>tf(PhyloExpressionSetExample[1:5,1:8],log2)</code>. In general, using <code>log2</code> transformed expression levels as input <code>ExpressionSet</code> of <code>DiffGenes()</code> allows us to (at least) assume that samples (replicate expression levels) used to perform the <code>Welch t-test</code> are log-normal distributed and therefore, somewhat approximate normal distributed.</p>
<p>Please notice however, that RNA-Seq data can include count values of 0. So when transforming absolute counts to <code>log2</code> counts infinity values of <code>log2(0) = -Inf</code> will be produced and therefore, p-value computations will not be possible. To avoid this case you could either remove RNA-Seq count values of 0 from the input dataset using the <code>Expressed()</code> function (see section <em>Filter for Expressed Genes</em>), e.g. pass <code>tf(Expressed(PhyloExpressionSetExample[1:5,1:8], cut.off = 1),log2)</code> as <code>ExpressionSet</code> argument to <code>DiffGenes()</code> or shift all count values by a constant value, e.g. pass <code>tf(PhyloExpressionSetExample[1:5,1:8], function(x) log2(x + 1))</code> as <code>ExpressionSet</code> argument to <code>DiffGenes()</code>.</p>
<p>Internally, <code>DiffGenes()</code> will also check for 0 values in input data and will automatically shift all expression levels by <code>+1</code> in case 0 values are included.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by a Welch t-test</span>
ttest.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> <span class="kw">tf</span>(PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],log2),
                        <span class="dt">nrep          =</span> <span class="dv">2</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;t.test&quot;</span>,
                        <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># look at the results</span>
ttest.DEGs</code></pre>
<pre><code>  Phylostratum      GeneID     S1&lt;-&gt;S2    S1&lt;-&gt;S3    S2&lt;-&gt;S3
1            1 at1g01040.2 0.027832572 0.04020203 0.13481563
2            1 at1g01050.1 0.852379466 0.31471871 0.36326955
3            1 at1g01070.1 0.003200692 0.00113536 0.02236621
4            1 at1g01080.2 0.086426813 0.03092924 0.45999438
5            1 at1g01090.1 0.090387087 0.04638872 0.04978092</code></pre>
<p>The resulting <code>data.frame</code> stores the p-values of stage-wise comparisons for each gene. To adjust p-values for multiple testing of stage-wise comparisons you can specify the <code>p.adjust.method</code> argument with one of the p-value adjustment methods implemented in <code>DiffGenes()</code>.</p>
<p>In detail, correcting for multiple testing allows to appropriately choose selection cut-offs for p-values fulfilling the differential expression criteria. Hahne et al., 2008 (p. 87) give a nice example of correcting for multiple testing to determine appropriate selection cut-offs.</p>
<p>Please consult the documentation of <code>?p.adjust</code> to see which p-value adjustment methods are implemented in <code>DiffGenes()</code>.</p>
<p>Please also consult these reviews (<a href="http://www.biostathandbook.com/multiplecomparisons.html">Biostatistics Handbook</a>, <a href="http://www.stat.columbia.edu/~gelman/research/published/multiple2f.pdf">Gelman et al., 2008</a>, and <a href="http://www.gs.washington.edu/academics/courses/akey/56008/lecture/lecture10.pdf">Slides</a>) to decide whether or not to apply p-value adjustment to your own dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by a Welch t-test</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
ttest.DEGs.p_adjust &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet   =</span> <span class="kw">tf</span>(PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],log2),
                                 <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                 <span class="dt">method          =</span> <span class="st">&quot;t.test&quot;</span>,
                                 <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>,
                                 <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))


ttest.DEGs.p_adjust</code></pre>
<pre><code>  Phylostratum      GeneID    S1&lt;-&gt;S2   S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.06958143 0.0579859 0.2246927
2            1 at1g01050.1 0.85237947 0.3147187 0.4540869
3            1 at1g01070.1 0.01600346 0.0056768 0.1118311
4            1 at1g01080.2 0.11298386 0.0579859 0.4599944
5            1 at1g01090.1 0.11298386 0.0579859 0.1244523</code></pre>
<p>The resulting p-value adjusted <code>data.frame</code> can be used to filter for differentially expressed genes. Here, specifying the arguments: <code>comparison</code>, <code>alpha</code>, and <code>filter.method</code> in <code>DiffGenes()</code> allows users to obtain only significant differentially expressed genes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Detection of DEGs using the p-value returned by a Welch t-test</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
<span class="co"># and filter for significantly differentially expressed genes (alpha = 0.05) </span>
ttest.DEGs.p_adjust.filtered &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet   =</span> <span class="kw">tf</span>(PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">10</span> ,<span class="dv">1</span>:<span class="dv">8</span>],log2),
                                          <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                          <span class="dt">method          =</span> <span class="st">&quot;t.test&quot;</span>,
                                          <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>,
                                          <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>),
                                          <span class="dt">comparison      =</span> <span class="st">&quot;above&quot;</span>,
                                          <span class="dt">alpha           =</span> <span class="fl">0.05</span>,
                                          <span class="dt">filter.method   =</span> <span class="st">&quot;n-set&quot;</span>,
                                          <span class="dt">n               =</span> <span class="dv">1</span>)

<span class="co"># look at the genes fulfilling the filter criteria </span>
ttest.DEGs.p_adjust.filtered</code></pre>
<pre><code>  Phylostratum      GeneID    S1&lt;-&gt;S2   S1&lt;-&gt;S3   S2&lt;-&gt;S3
3            1 at1g01070.1 0.03200692 0.0113536 0.2192432</code></pre>
<p>In this example, only 1 out of 10 genes fulfills the p-value criteria (<code>alpha = 0.05</code>) in at least one stage comparison.</p>
<div id="rank-top-p-values" class="section level4">
<h4>Rank top p-values</h4>
<p>Finally, users can rank genes in increasing p-value order for each stage comparison by typing:</p>
<pre class="sourceCode r"><code class="sourceCode r">ttest.DEGs.p_adjust &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet   =</span> <span class="kw">tf</span>(PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">500</span>,<span class="dv">1</span>:<span class="dv">8</span>],log2),
                                 <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                 <span class="dt">method          =</span> <span class="st">&quot;t.test&quot;</span>,
                                 <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>,
                                 <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))


<span class="kw">head</span>(ttest.DEGs.p_adjust[<span class="kw">order</span>(ttest.DEGs.p_adjust[ , <span class="st">&quot;S1&lt;-&gt;S2&quot;</span>], <span class="dt">decreasing =</span> <span class="ot">FALSE</span>) , <span class="dv">1</span>:<span class="dv">3</span>])</code></pre>
<pre><code>    Phylostratum      GeneID  S1&lt;-&gt;S2
54             1 at1g02400.1 0.151388
119            1 at1g03870.1 0.151388
137            1 at1g04380.1 0.151388
289            1 at1g08110.4 0.151388
383            1 at1g10360.1 0.151388
413            1 at1g11040.1 0.151388</code></pre>
<p>Here the line <code>ttest.DEGs.p_adjust[order(ttest.DEGs.p_adjust[ , &quot;S1&lt;-&gt;S2&quot;], decreasing = FALSE) , 1:3]</code> will sort p-values of stage comparison <code>&quot;S1&lt;-&gt;S2&quot;</code> in increasing order.</p>
</div>
</div>
</div>
<div id="wilcoxon-mann-whitney-test-mann-whitney-u-test" class="section level2">
<h2>Wilcoxon-Mann-Whitney test (Mann-Whitney U test)</h2>
<p>The Wilcoxon-Mann-Whitney test is a <em>nonparametric</em> test to quantify the shift in empirical distribution parameters. <em>Nonparametric</em> tests are useful when sample populations do not meet the test assumptions of <em>parametric</em> tests.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by a Wilcoxon-Mann-Whitney test</span>
Wilcox.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                        <span class="dt">nrep          =</span> <span class="dv">2</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;wilcox.test&quot;</span>,
                        <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># look at the results</span>
Wilcox.DEGs</code></pre>
<pre><code>  Phylostratum      GeneID   S1&lt;-&gt;S2   S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.3333333 0.3333333 0.3333333
2            1 at1g01050.1 1.0000000 0.3333333 0.3333333
3            1 at1g01070.1 0.3333333 0.3333333 0.3333333
4            1 at1g01080.2 0.3333333 0.3333333 0.6666667
5            1 at1g01090.1 0.3333333 0.3333333 0.3333333</code></pre>
<p>Again, users can adjust p-values by specifying the <code>p.adjust.method</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by a Wilcoxon-Mann-Whitney test</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
<span class="co"># and filter for significantly differentially expressed genes (alpha = 0.05)</span>
Wilcox.DEGs.adj &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet  =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                            <span class="dt">nrep            =</span> <span class="dv">2</span>,
                            <span class="dt">method          =</span> <span class="st">&quot;wilcox.test&quot;</span>,
                            <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>),
                            <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)

<span class="co"># look at the results</span>
Wilcox.DEGs.adj</code></pre>
<pre><code>  Phylostratum      GeneID   S1&lt;-&gt;S2   S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.4166667 0.3333333 0.4166667
2            1 at1g01050.1 1.0000000 0.3333333 0.4166667
3            1 at1g01070.1 0.4166667 0.3333333 0.4166667
4            1 at1g01080.2 0.4166667 0.3333333 0.6666667
5            1 at1g01090.1 0.4166667 0.3333333 0.4166667</code></pre>
</div>
<div id="negative-binomial-exact-tests" class="section level2">
<h2>Negative Binomial (Exact Tests)</h2>
<p>Exact Tests for Differences between two groups of negative-binomial counts implemented in <code>DiffGenes()</code> are based on the <code>edgeR</code> function <code>exactTest()</code>. Please consult the <a href="http://www.bioconductor.org/packages/release/bioc/vignettes/edgeR/inst/doc/edgeRUsersGuide.pdf">edgeR Users Guide</a> for mathematical details.</p>
<div id="install-edger-package" class="section level3">
<h3>Install edgeR Package</h3>
<p>The detection of DEGs using negative binomial models is based on the powerful implementations provided by the <a href="http://www.bioconductor.org/packages/release/bioc/html/edgeR.html">edgeR</a> package. Hence, before using the negative binomial models in <code>DiffGenes()</code> users need to install the edgeR package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install edgeR</span>
<span class="kw">source</span>(<span class="st">&quot;http://bioconductor.org/biocLite.R&quot;</span>)
<span class="kw">biocLite</span>(<span class="st">&quot;edgeR&quot;</span>)</code></pre>
</div>
<div id="double-tail-method" class="section level3">
<h3>Double Tail Method</h3>
<p>This method computes two-sided p-values by doubling the smaller tail probability (see <code>?exactTestByDeviance</code> for details). To compute p-values for stagewise comparisons based on negative binomial models, the <code>DiffGenes()</code> argument <code>method = &quot;doubletail&quot;</code>, the number of replicates per stage <code>nrep</code>, and <code>lib.size</code> quantifying the library size to equalize sample library sizes by quantile-to-quantile normalization need to be specified (see also <code>?equalizeLibSizes</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Double Tail Method</span>
DoubleTail.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                        <span class="dt">nrep          =</span> <span class="dv">2</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;doubletail&quot;</span>,
                        <span class="dt">lib.size      =</span> <span class="dv">1000</span>,
                        <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># look at the results</span>
DoubleTail.DEGs</code></pre>
<pre><code>  Phylostratum      GeneID    S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.26026604 0.110233012 0.6304508
2            1 at1g01050.1 0.95314428 0.598102712 0.6398757
3            1 at1g01070.1 0.55461941 0.456018563 0.8774231
4            1 at1g01080.2 0.58130025 0.487028051 0.8860005
5            1 at1g01090.1 0.03615134 0.001773543 0.2645537</code></pre>
<p>Again, users can adjust p-values by specifying the <code>p.adjust.method</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Double Tail Method</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
<span class="co"># and filter for significantly differentially expressed genes (alpha = 0.05)</span>
DoubleTail.DEGs.adj &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet  =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                                <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                <span class="dt">method          =</span> <span class="st">&quot;doubletail&quot;</span>,
                                <span class="dt">lib.size        =</span> <span class="dv">1000</span>,
                                <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>),
                                <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)

<span class="co"># look at the results</span>
DoubleTail.DEGs.adj</code></pre>
<pre><code>  Phylostratum      GeneID   S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.6506651 0.275582530 0.8860005
2            1 at1g01050.1 0.9531443 0.598102712 0.8860005
3            1 at1g01070.1 0.7266253 0.598102712 0.8860005
4            1 at1g01080.2 0.7266253 0.598102712 0.8860005
5            1 at1g01090.1 0.1807567 0.008867715 0.8860005</code></pre>
</div>
<div id="small-p-method" class="section level3">
<h3>Small-P Method</h3>
<p>This method performs the method of small probabilities as proposed by Robinson and Smyth (2008) (see <code>exactTestBySmallP</code> for details). To compute p-values for stagewise comparisons based on negative binomial models, the <code>DiffGenes()</code> argument <code>method = &quot;doubletail&quot;</code>, the number of replicates per stage <code>nrep</code>, and <code>lib.size</code> quantifying the library size to equalize sample library sizes by quantile-to-quantile normalization need to be specified (see also <code>?equalizeLibSizes</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Small-P Method</span>
SmallP.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                        <span class="dt">nrep          =</span> <span class="dv">2</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;smallp&quot;</span>,
                        <span class="dt">lib.size      =</span> <span class="dv">1000</span>,
                        <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># look at the results</span>
SmallP.DEGs</code></pre>
<pre><code>  Phylostratum      GeneID    S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.26026604 0.110233012 0.6304508
2            1 at1g01050.1 0.95314428 0.598102712 0.6398757
3            1 at1g01070.1 0.55461941 0.456018563 0.8774231
4            1 at1g01080.2 0.58130025 0.487028051 0.8860005
5            1 at1g01090.1 0.03615134 0.001773543 0.2645537</code></pre>
<p>Again, users can adjust p-values by specifying the <code>p.adjust.method</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Small-P Method</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
<span class="co"># and filter for significantly differentially expressed genes (alpha = 0.05)</span>
SmallP.DEGs.adj &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet  =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                                <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                <span class="dt">method          =</span> <span class="st">&quot;smallp&quot;</span>,
                                <span class="dt">lib.size        =</span> <span class="dv">1000</span>,
                                <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>),
                                <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)

<span class="co"># look at the results</span>
SmallP.DEGs.adj</code></pre>
<pre><code>  Phylostratum      GeneID   S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.6506651 0.275582530 0.8860005
2            1 at1g01050.1 0.9531443 0.598102712 0.8860005
3            1 at1g01070.1 0.7266253 0.598102712 0.8860005
4            1 at1g01080.2 0.7266253 0.598102712 0.8860005
5            1 at1g01090.1 0.1807567 0.008867715 0.8860005</code></pre>
</div>
<div id="deviance-method" class="section level3">
<h3>Deviance Method</h3>
<p>This method uses the deviance goodness of fit statistics to define the rejection region, and is therefore equivalent to a conditional likelihood ratio test (see <code>exactTestByDeviance</code> for details). To compute p-values for stagewise comparisons based on negative binomial models, the <code>DiffGenes()</code> argument <code>method = &quot;doubletail&quot;</code>, the number of replicates per stage <code>nrep</code>, and <code>lib.size</code> quantifying the library size to equalize sample library sizes by quantile-to-quantile normalization need to be specified (see also <code>?equalizeLibSizes</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Deviance</span>
Deviance.DEGs &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                        <span class="dt">nrep          =</span> <span class="dv">2</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;deviance&quot;</span>,
                        <span class="dt">lib.size      =</span> <span class="dv">1000</span>,
                        <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># look at the results</span>
Deviance.DEGs</code></pre>
<pre><code>  Phylostratum      GeneID    S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.26026604 0.110233012 0.6304508
2            1 at1g01050.1 0.95314428 0.598102712 0.6398757
3            1 at1g01070.1 0.55461941 0.456018563 0.8774231
4            1 at1g01080.2 0.58130025 0.487028051 0.8860005
5            1 at1g01090.1 0.03615134 0.001773543 0.2645537</code></pre>
<p>Again, users can adjust p-values by specifying the <code>p.adjust.method</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PhyloExpressionSetExample&quot;</span>)

<span class="co"># Detection of DEGs using the p-value returned by the Deviance Method</span>
<span class="co"># and furthermore, adjust p-values for multiple comparison</span>
<span class="co"># using the Benjamini &amp; Hochberg (1995) method: method = &quot;BH&quot;</span>
<span class="co"># and filter for significantly differentially expressed genes (alpha = 0.05)</span>
Deviance.DEGs.adj &lt;-<span class="st"> </span><span class="kw">DiffGenes</span>(<span class="dt">ExpressionSet    =</span> PhyloExpressionSetExample[<span class="dv">1</span>:<span class="dv">5</span>,<span class="dv">1</span>:<span class="dv">8</span>],
                                <span class="dt">nrep            =</span> <span class="dv">2</span>,
                                <span class="dt">method          =</span> <span class="st">&quot;deviance&quot;</span>,
                                <span class="dt">lib.size        =</span> <span class="dv">1000</span>,
                                <span class="dt">stage.names     =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>),
                                <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)

<span class="co"># look at the results</span>
Deviance.DEGs.adj</code></pre>
<pre><code>  Phylostratum      GeneID   S1&lt;-&gt;S2     S1&lt;-&gt;S3   S2&lt;-&gt;S3
1            1 at1g01040.2 0.6506651 0.275582530 0.8860005
2            1 at1g01050.1 0.9531443 0.598102712 0.8860005
3            1 at1g01070.1 0.7266253 0.598102712 0.8860005
4            1 at1g01080.2 0.7266253 0.598102712 0.8860005
5            1 at1g01090.1 0.1807567 0.008867715 0.8860005</code></pre>
</div>
</div>
<div id="collapsing-replicate-samples" class="section level2">
<h2>Collapsing Replicate Samples</h2>
<p>After performing differential gene expression analyses, replicate expression levels are collapsed to a single stage specific expression level. For this purpose, <code>myTAI</code> implements the <code>CollapseReplicates()</code> function, allowing users to combine replicate expression levels stored in a standard <code>PhyloExpressionSet</code> or <code>DivergenceExpressionSet</code> object to a stage specific expression level using a specified <a href="http://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html">window function</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(myTAI)

<span class="co"># load example data</span>
<span class="kw">data</span>(PhyloExpressionSetExample)

<span class="co"># genrate an example PhyloExpressionSet with replicates</span>
ExampleReplicateExpressionSet &lt;-<span class="st"> </span>PhyloExpressionSetExample[ ,<span class="dv">1</span>:<span class="dv">8</span>]

<span class="co"># rename stages</span>
<span class="kw">names</span>(ExampleReplicateExpressionSet)[<span class="dv">3</span>:<span class="dv">8</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Stage_1_Repl_1&quot;</span>,<span class="st">&quot;Stage_1_Repl_2&quot;</span>,
                                               <span class="st">&quot;Stage_2_Repl_1&quot;</span>,<span class="st">&quot;Stage_2_Repl_2&quot;</span>,
                                               <span class="st">&quot;Stage_3_Repl_1&quot;</span>,<span class="st">&quot;Stage_3_Repl_2&quot;</span>)
<span class="co"># have a look at the example dataset</span>
<span class="kw">head</span>(ExampleReplicateExpressionSet, <span class="dv">5</span>)</code></pre>
<pre><code>  Phylostratum      GeneID Stage_1_Repl_1 Stage_1_Repl_2 Stage_2_Repl_1 Stage_2_Repl_2 Stage_3_Repl_1 Stage_3_Repl_2
1            1 at1g01040.2       2173.635      1911.2001       1152.555      1291.4224       1000.253       962.9772
2            1 at1g01050.1       1501.014      1817.3086       1665.309      1564.7612       1496.321      1114.6435
3            1 at1g01070.1       1212.793      1233.0023        939.200       929.6195        864.218       877.2060
4            1 at1g01080.2       1016.920       936.3837       1181.338      1329.4734       1392.643      1287.9746
5            1 at1g01090.1      11424.567     16778.1685      34366.649     39775.6405      56231.569     66980.3673</code></pre>
<p>Now, assume that this example <code>PhyloExpressionSet</code> stores three developmental stages and 2 biological replicates for each developmental stage. Of course, we could now compute and visualize the TAI profile by typing:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualize the TAI profile over 3 stages of development</span>
<span class="co"># and 2 replicates per stage</span>
<span class="kw">PlotPattern</span>(<span class="dt">ExpressionSet =</span> ExampleReplicateExpressionSet,
            <span class="dt">type          =</span> <span class="st">&quot;l&quot;</span>,
            <span class="dt">lwd           =</span> <span class="dv">6</span>)</code></pre>
<p>Usually, one would expect that variations in replicate values are smaller than variations between developmental stages. In this example however, we constructed replicate values that vary larger than expression levels between developmental stages. For many applications it might be useful to visualize TAI/TDI values of replicates as well, but normally replicate values are collapsed to one gene and stage specific value after differential gene expression analyses and replicate quality control have been performed.</p>
<p>The following example illustrates how to collapse replicates with <code>CollapseReplicates()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># combine the expression levels of the 2 replicates (const) per stage</span>
<span class="co"># using geom.mean as window function and rename new stages to: &quot;S1&quot;,&quot;S2&quot;,&quot;S3&quot;</span>
CollapssedPhyloExpressionSet &lt;-<span class="st"> </span><span class="kw">CollapseReplicates</span>(
                                       <span class="dt">ExpressionSet =</span> ExampleReplicateExpressionSet,
                                       <span class="dt">nrep          =</span> <span class="dv">2</span>,
                                       <span class="dt">FUN           =</span> geom.mean,
                                       <span class="dt">stage.names   =</span> <span class="kw">c</span>(<span class="st">&quot;S1&quot;</span>,<span class="st">&quot;S2&quot;</span>,<span class="st">&quot;S3&quot;</span>))

<span class="co"># have a look at the collpased PhyloExpressionSet</span>
<span class="kw">head</span>(CollapssedPhyloExpressionSet)</code></pre>
<pre><code>   Phylostratum      GeneID         S1         S2         S3
1            1 at1g01040.2  2038.1982  1220.0147   981.4381
2            1 at1g01050.1  1651.6070  1614.2524  1291.4582
3            1 at1g01070.1  1222.8557   934.3975   870.6878
4            1 at1g01080.2   975.8215  1253.2189  1339.2866
5            1 at1g01090.1 13844.9740 36972.3612 61371.0937
6            1 at1g01120.1   815.3288   894.8987   905.8272</code></pre>
<p>The <code>nrep</code> argument specifies either a constant number of replicates per stage or a numeric vector storing variable numbers of replicates for each developmental stage. In our example, each developmental stage had a constant (equal) number of replicates per developmental stage (<code>nrep = 2</code>). In case a variable stage specific number of replicates is present, one could specify <code>nrep = c(2,3,2)</code> defining the case that developmental stage 1 stores 2 replicates, stage 2 stores 3 replicates, and stage 3 again, stores 2 replicates.</p>
<p>The argument <code>FUN</code> specifies the window function to collapse replicate expression levels to a single stage specific value. In this example, we chose the <code>geom.mean()</code> (geometric mean) function implemented in <code>myTAI</code>, because our example <code>PhyloExpressionSet</code> stores absolute expression levels. Notice that the mathematical equivalent of performing arithmetic mean (<code>mean()</code>) computations on <code>log</code> expression levels is to perform the geometric mean (<code>geom.mean()</code>) on absolute expression levels.</p>
<p>The <code>stage.names</code> argument then specifies the new names of collapsed stages.</p>
</div>
<div id="filter-for-expressed-genes" class="section level2">
<h2>Filter for Expressed Genes</h2>
<p>After differential gene expression analyses and replicate aggregation have been performed, some studies filter gene expression levels in RNA-Seq count tables or microarray expression matrices for non-expressed or outlier genes. For example, in most studies performing RNA-Seq experiments FPKM/RPKM values &lt; 1 are remove from the processed (final) count table.</p>
<p>For this purpose <code>myTAI</code> implements the <code>Expressed()</code> function to filter (remove) expression levels in RNA-Seq count tables or microarray expression matrices which do not pass a defined expression threshold.</p>
<p>The <code>Expressed()</code> function takes a standard <code>PhyloExpressionSet</code> or <code>DivergenceExpressionSet</code> object storing a RNA-Seq count table (CT) or microarray gene expression matrix and removes genes from this count table or gene expression matrix that have an expression level below a defined <code>cut.off</code> value.</p>
<p><code>Expressed()</code> allows users to choose from several gene extraction methods (see <code>?Expressed</code> for details):</p>
<ul>
<li><p><code>const</code>: all genes that have at least one stage that undercuts or exceeds the expression <code>cut.off</code> will be excluded from the <code>ExpressionSet</code>. Hence, for a 7 stage <code>ExpressionSet</code> genes passing the expression level <code>cut.off</code> in 6 stages will be retained in the <code>ExpressionSet</code>.</p></li>
<li><p><code>min-set</code>: genes passing the expression level <code>cut.off</code> in <code>ceiling(n/2)</code> stages will be retained in the <code>ExpressionSet</code>, where <code>n</code> is the number of stages in the <code>ExpressionSet</code>.</p></li>
<li><p><code>n-set</code>: genes passing the expression level <code>cut.off</code> in <code>n</code> stages will be retained in the <code>ExpressionSet</code>. Here, the argument <code>n</code> is defining the number of stages for which the threshold criteria should be fulfilled.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check number of genes in PhyloExpressionSetExample</span>
<span class="kw">nrow</span>(PhyloExpressionSetExample)
<span class="co">#&gt; [1] 25260</span>

<span class="co"># remove genes that have an expression level below 8000</span>
<span class="co"># in at least one developmental stage</span>
FilterConst &lt;-<span class="st"> </span><span class="kw">Expressed</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample,
                         <span class="dt">cut.off       =</span> <span class="dv">8000</span>,
                         <span class="dt">comparison    =</span> <span class="st">&quot;below&quot;</span>, 
                         <span class="dt">method        =</span> <span class="st">&quot;const&quot;</span>)

<span class="kw">nrow</span>(FilterConst) <span class="co"># check number of retained genes</span>
<span class="co">#&gt; [1] 449</span></code></pre>
<p>Users will observe that only 449 out of 25260 genes in <code>PhyloExpressionSetExample</code> have an absolute expression level above <code>8000</code> when omitting genes using <code>method = 'const'</code>. The argument <code>comparison</code> specifies whether genes having expression levels below, above, or below AND above (both) the <code>cut.off</code> value should be removed from the dataset.</p>
<p>The following comparison methods can be selected:</p>
<ul>
<li><code>comparison = &quot;below&quot;</code>: define genes as not expressed which undercut the <code>cut-off</code> threshold.</li>
<li><code>comparison = &quot;above&quot;</code>: define genes as outliers which exceed the <code>cut-off</code> threshold.</li>
<li><code>comparison = &quot;both&quot;</code>: remove genes fulfilling the <code>comparison = &quot;below&quot;</code> <strong>AND</strong> <code>comparison = &quot;above&quot;</code> criteria.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># again: check number of genes in PhyloExpressionSetExample</span>
<span class="kw">nrow</span>(PhyloExpressionSetExample)
<span class="co">#&gt; [1] 25260</span>

<span class="co"># remove genes that have an expression level above 12000</span>
<span class="co"># in at least one developmental stage (outlier removal)</span>
FilterConst.above &lt;-<span class="st"> </span><span class="kw">Expressed</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample,
                               <span class="dt">cut.off       =</span> <span class="dv">12000</span>,
                               <span class="dt">comparison    =</span> <span class="st">&quot;above&quot;</span>, 
                               <span class="dt">method        =</span> <span class="st">&quot;const&quot;</span>)

<span class="kw">nrow</span>(FilterConst.above) <span class="co"># check number of retained genes</span>
<span class="co">#&gt; [1] 23547</span></code></pre>
<p>For this example 25260 - 23547 = 1713 have been classified as outliers (expression levels above 12000) and were removed from the dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># again: check number of genes in PhyloExpressionSetExample</span>
<span class="kw">nrow</span>(PhyloExpressionSetExample)
<span class="co">#&gt; [1] 25260</span>

<span class="co"># remove genes that have an expression level below 8000 AND above 12000</span>
<span class="co"># in at least one developmental stage (non-expressed genes AND outlier removal)</span>
FilterConst.both &lt;-<span class="st">  </span><span class="kw">Expressed</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample,
                               <span class="dt">cut.off       =</span> <span class="kw">c</span>(<span class="dv">8000</span>,<span class="dv">12000</span>),
                               <span class="dt">comparison    =</span> <span class="st">&quot;both&quot;</span>, 
                               <span class="dt">method        =</span> <span class="st">&quot;const&quot;</span>)

<span class="kw">nrow</span>(FilterConst.both) <span class="co"># check number of retained genes</span>
<span class="co">#&gt; [1] 2</span></code></pre>
<p>When selecting <code>comparison = 'both'</code>, the <code>cut.off</code> argument receives 2 threshold values: the <em>below</em> <code>cut.off</code> as first element and the <em>above</em> <code>cut.off</code> as second element. In this case <code>cut.off = c(8000,12000)</code>. Here, only 2 genes fulfill these criteria.</p>
<p>Analogously, users can specify the number of stages that should fulfill the threshold criteria using the <code>n-set</code> method.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove genes that have an expression level below 8000</span>
<span class="co"># in at least 5 developmental stages (in this case: n = 2 stages fulfilling the criteria)</span>
FilterNSet &lt;-<span class="st"> </span><span class="kw">Expressed</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample,
                        <span class="dt">cut.off       =</span> <span class="dv">8000</span>,
                        <span class="dt">method        =</span> <span class="st">&quot;n-set&quot;</span>,
                        <span class="dt">comparison    =</span> <span class="st">&quot;below&quot;</span>,
                        <span class="dt">n             =</span> <span class="dv">2</span>)

<span class="kw">nrow</span>(FilterMinSet) <span class="co"># check number of retained genes</span>
<span class="co">#&gt; [1] 20</span></code></pre>
<p>Here, 20 genes are fulfilling these criteria.</p>
</div>
<div id="compute-the-statistical-significance-of-each-replicate-combination" class="section level2">
<h2>Compute the Statistical Significance of Each Replicate Combination</h2>
<p>In some cases (high variability of replicates) it might be useful to verify that there is no sequence of replicates (for all possible combination of replicates) that results in a non-significant <code>TAI</code> or <code>TDI</code> pattern, when the initial pattern with combined replicates was shown to be significant.</p>
<p>The <code>CombinatorialSignificance()</code> function implemented in <code>myTAI</code> allows users to compute the p-values quantifying the statistical significance of the underlying pattern for all combinations of replicates.</p>
<div id="a-small-example" class="section level3">
<h3>A small Example:</h3>
<p>Assume a <code>PhyloExpressionSet</code> stores 3 developmental stages with 3 replicates measured for each stage. The 9 replicates in total are denoted as: <span class="math">\(1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3\)</span>. Now the function computes the statistical significance of each pattern derived by the corresponding combination of replicates, e.g.</p>
<ul>
<li><p>1.1, 2.1, 3.1 : p-value for combination 1</p></li>
<li><p>1.1, 2.2, 3.1 : p-value for combination 2</p></li>
<li><p>1.1, 2.3, 3.1 : p-value for combination 3</p></li>
<li><p>1.2, 2.1, 3.1 : p-value for combination 4</p></li>
<li><p>1.2, 2.1, 3.1 : p-value for combination 5</p></li>
<li><p>1.2, 2.1, 3.1 : p-value for combination 6</p></li>
<li><p>1.3, 2.1, 3.1 : p-value for combination 7</p></li>
<li><p>1.3, 2.2, 3.1 : p-value for combination 8</p></li>
<li><p>1.3, 2.3, 3.1 : p-value for combination 9</p></li>
<li><p>…</p></li>
</ul>
<p>This procedure yields 27 p-values for the <span class="math">\(3^3\)</span> (<span class="math">\(n^m\)</span>) replicate combinations, where <span class="math">\(n\)</span> denotes the number of developmental stages and <span class="math">\(m\)</span> denotes the number of replicates per stage.</p>
<p>Note that in case users have a large amount of stages/experiments and a large amount of replicates the computation time will increase by <span class="math">\(n^m\)</span>. For 11 stages and 4 replicates, <span class="math">\(4^{11}\)</span> = 4194304 p-values have to be computed. Each p-value computation itself is based on a permutation test running with <span class="math">\(1,000, 10,000, ...\)</span> or more permutations. Be aware that this might take some time.</p>
<p>The p-value vector returned by this function can then be used to plot the p-values to see whether an critical value <span class="math">\(\alpha\)</span> is exceeded or not (e.g. <span class="math">\(\alpha = 0.05\)</span>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load a standard PhyloExpressionSet</span>
<span class="kw">data</span>(PhyloExpressionSetExample)

<span class="co"># we assume that the PhyloExpressionSetExample</span>
<span class="co"># consists of 3 developmental stages</span>
<span class="co"># and 2 replicates for stage 1, 3 replicates for stage 2,</span>
<span class="co"># and 2 replicates for stage 3</span>
<span class="co"># FOR REAL ANALYSES PLEASE USE: permutations = 1000 or 10000</span>
<span class="co"># BUT NOTE THAT THIS TAKES MUCH MORE COMPUTATION TIME</span>
p.vector &lt;-<span class="st"> </span><span class="kw">CombinatorialSignificance</span>(<span class="dt">ExpressionSet =</span> PhyloExpressionSetExample,
                                      <span class="dt">replicates    =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>),
                                      <span class="dt">TestStatistic =</span> <span class="st">&quot;FlatLineTest&quot;</span>,
                                      <span class="dt">permutations  =</span> <span class="dv">100</span>,
                                      <span class="dt">parallel      =</span> <span class="ot">FALSE</span>)</code></pre>
<pre><code> [1] 2.436296e-03 2.288593e-02 1.608399e-03 1.185615e-02 1.835306e-06 1.077012e-05
 [7] 2.025515e-07 5.148342e-07 1.654885e-07 6.251145e-06 9.265520e-10 1.047479e-06</code></pre>
<p>Users will observe that none of the replicate combinations resulted in p-values &gt; 0.05 and thus we can assume that the phylotranscriptomic pattern computed based on collapsed replicates is not biased by insignificant replicate combinations.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">any</span>(p.vector &gt;<span class="st"> </span><span class="fl">0.05</span>)
<span class="co">#&gt; FALSE</span></code></pre>
<p><code>CombinatorialSignificance()</code> can perform all significance tests introduced in the <a href="Introduction.html">Introduction</a> and <a href="Intermediate.html">Intermediate</a> vignettes.</p>
<p>Furthermore, the <code>parallel</code> argument allows users to perform significance computations in parallel on a multicore machine. This will speed up p-value computations for a large number of combinations.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
